<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia Interactiva</title>
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    .hud{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
         background:rgba(20,15,35,.25);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:8px;
         backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .hud button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);color:#fff}
    .hud input[type=file]{display:none}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#fff;font:12px system-ui}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Arrastra ‚Ä¢ Pinch/rueda ‚Ä¢ Doble toque: efecto</div>
<div id="err" class="error"></div>

<div class="hud">
  <button id="playBtn">‚ñ∂Ô∏é</button>
  <span style="font-size:12px;opacity:.9">Puedes seleccionar tu MP3</span>
  <input type="file" id="pickFile" accept="audio/*">
  <button id="pickBtn">Elegir canci√≥n</button>
  <audio id="audio" preload="none"><source id="songSrc" src="Love Grows - (HARD) Piano Tutorial - FULL VERSION - Steven Fox.mp3" type="audio/mpeg"></audio>
</div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
const CONFIG = {
  songFile: 'Love Grows - (HARD) Piano Tutorial - FULL VERSION - Steven Fox.mp3',
  phrases: [
    'Mi Luna','Mi amor ‚ù§Ô∏è','Preciosa üòç','Mi cielo üåå','Eres mi todo ‚ú®',
    'Siempre t√∫ ‚ôæÔ∏è','Gracias por estar üôè','Te amo mucho ü•∞','Me encantas üí´','Te aprecio ü§ç',
    'Amo tu voz üé∂','Anhelo tu sonrisa üòä','Reinota üëë','Mi patojita','Mi princesa',
    'Mi estrellaüå†','Mi vida üíñ','Hola preciosa ‚ú®','¬øPor qu√© tan linda? ü§≠','Te extra√±o ü´∂',
    'Te pienso üí≠','Amo tus ojitos üëÄ','Contigo üíë','Quiero que seas t√∫ üíñ','Juntos siempre ‚ôæÔ∏è'
  ],
  theme: 'pink',   // violet | pink | red
  shape: 'oval',   // round | oval
  effect: 'sparks' // hearts | sparks
};

// ==== AUDIO ====
const audio = document.getElementById('audio');
const songSrc = document.getElementById('songSrc');
songSrc.src = CONFIG.songFile;
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');
playBtn.onclick = async () => {
  try { if (audio.paused) { await audio.play(); playBtn.textContent='‚è∏Ô∏é'; } else { audio.pause(); playBtn.textContent='‚ñ∂Ô∏é'; } }
  catch(e){ alert('Si no suena, toca ‚ÄúElegir canci√≥n‚Äù y selecciona tu MP3.'); }
};
pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
  if (pickFile.files && pickFile.files[0]) {
    const url = URL.createObjectURL(pickFile.files[0]);
    audio.src = url; audio.play().then(()=> playBtn.textContent='‚è∏Ô∏é').catch(()=>{});
  }
};

// ==== WEBGL ====
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.set(0,26,110);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// Fondo estrellas
function makeStarTexture(size=1024, count=2400) {
  const c = document.createElement('canvas'); c.width=c.height=size;
  const g = c.getContext('2d');
  g.fillStyle = '#200010'; g.fillRect(0,0,size,size);
  for (let i=0;i<count;i++) {
    const x = Math.random()*size, y = Math.random()*size;
    g.fillStyle = 'rgba(255,255,255,'+(Math.random()*0.8)+')';
    g.fillRect(x,y,1,1);
  }
  return new THREE.CanvasTexture(c);
}
scene.add(new THREE.Mesh(new THREE.SphereGeometry(600,64,64),
  new THREE.MeshBasicMaterial({ map: makeStarTexture(), side: THREE.BackSide })));

// Frases
const galaxy = new THREE.Group(); scene.add(galaxy);
for (let i=0;i<CONFIG.phrases.length*6;i++){
  const text = CONFIG.phrases[i%CONFIG.phrases.length];
  const c=document.createElement('canvas');c.width=512;c.height=64;
  const g=c.getContext('2d');g.font='bold 32px Arial';g.fillStyle='#fff';g.textAlign='center';g.fillText(text,256,32);
  const tex=new THREE.CanvasTexture(c);
  const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true }));
  const angle=i/50*Math.PI*2; const dist=50+Math.random()*40;
  spr.position.set(Math.cos(angle)*dist,(Math.random()-0.5)*20,Math.sin(angle)*dist);
  spr.scale.set(15,3,1);
  galaxy.add(spr);
}

// Agujero negro + halo
const core=new THREE.Mesh(new THREE.SphereGeometry(12,64,64), new THREE.MeshBasicMaterial({color:0x330000}));
if(CONFIG.shape==='oval') core.scale.set(1.3,0.8,1.3);
scene.add(core);
const halo=new THREE.Mesh(new THREE.PlaneGeometry(360,300), new THREE.MeshBasicMaterial({color:0xff99cc,transparent:true,opacity:0.5,side:THREE.DoubleSide}));
halo.rotation.x=-Math.PI/2; scene.add(halo);

// Animaci√≥n
function animate(){
  requestAnimationFrame(animate);
  galaxy.rotation.y += 0.0015;
  controls.update();
  renderer.render(scene,camera);
}
animate();

// Doble toque efecto
const fx=document.getElementById('fx'); const ctx2=fx.getContext('2d');
function resizeFx(){fx.width=innerWidth*2;fx.height=innerHeight*2;fx.style.width=innerWidth+'px';fx.style.height=innerHeight+'px';}
resizeFx();addEventListener('resize',resizeFx);
const sparks=[];
function spawn(x,y){for(let i=0;i<20;i++)sparks.push({x:x*2,y:y*2,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:1});}
let lastTap=0;
addEventListener('click',e=>{if(performance.now()-lastTap<300)spawn(e.clientX,e.clientY);lastTap=performance.now();});
addEventListener('touchend',e=>{const t=e.changedTouches[0];if(performance.now()-lastTap<300)spawn(t.clientX,t.clientY);lastTap=performance.now();});
function loopFx(){ctx2.clearRect(0,0,fx.width,fx.height);for(let i=sparks.length-1;i>=0;i--){const s=sparks[i];s.x+=s.vx;s.y+=s.vy;s.life-=0.02;ctx2.fillStyle='rgba(255,220,180,'+s.life+')';ctx2.beginPath();ctx2.arc(s.x,s.y,3,0,Math.PI*2);ctx2.fill();if(s.life<=0)sparks.splice(i,1);}requestAnimationFrame(loopFx);}loopFx();
</script>
</body>
</html>

